PALLETIZER -*- mode: org -*-
#+STARTUP: showall

** TODO Optimizer:
*** DONE Path Triangulation.
*** DONE Return paths.
*** DONE Level Paths.
*** DONE Remove Point Duplicates.
*** DONE Extend vertical paths.
*** DONE Add Action Coordinates for pick and drop.
*** DONE Plugin to server.
*** DONE Make path avoid both top and bottom of box.
*** TODO Pick location lip height height: Vivian: "just use box height."
*** TODO Handle errors / ensure no errors.
*** DONE Use Line class.
*** DONE Top and bottom of box constraint.
*** TODO Clean up code and reduce total number of loops for speed.
*** TODO Enfore loop convergence on constraint solver (default to square path.)

** TODO Machine Configuration:
*** TODO Allow extra drive for V2. 

** DONE Pallet Configuration:
*** DONE θ coordinate must be numerical.

** TODO Layout Generator:
*** DONE Row Column-Fill (Version 1)
*** TODO Distance Optimization. -- See Max's changes/requirements.
*** TODO Extend algorithmn to rotate boxes to fit more in.

** TODO TeachMode:
*** DONE Compute rotation of pallet relative to box. (may not be relevant anymore.)
*** DONE Jogger Rotation Display.
*** DONE IO/Jog controller safety on use before initialization in subcomponents.
*** TODO Limit Stack Height.
*** TODO Something about setting box orientation.
*** DONE Add good pick detection in teach mode.
*** DONE θ coordinate numerical
*** DONE Round coordinates in the jogger.
*** DONE Update jogger to use numberical rotation (UI piece for this as well.)
*** DONE Make stack screen display stack in proper order.
*** DONE Fix stack screen delete bug.
*** TODO (Wait) Clean up configuration format (final box coordinates).
*** DONE Handle box size change -- sort out configurations.

** DONE mm-js-api:
*** DONE Use position from step counts. (Gain computation.) -- This is crucial for not causing giving strang positions when user jogs past end stops.
*** DONE Add m201, m203 commands.

** TODO Production:
*** TODO Logging.
*** TODO Update protocol -- git?

** TODO Jogger:
*** DONE Perspective Jogger
*** DONE Plugin controls.
*** TODO Improve beauty + usability.
*** DONE React memoization issue.
*** DONE Return to discrete rotations.

** TODO Engine:
*** DONE Add Good Pick Detection + Box Detection Actions.
*** TODO Consistent error messaging to client. (see: catch blocks and information send)

** DONE Configuration Page:
*** DONE Reload configs on create (so that they show up immediately).
*** DONE Machine config jogger.
*** DONE Delete Machine Motion.

** TODO Visualizer:
*** DONE Visualizer: Frame + coordinates + axes 
*** DONE Visualizer -- drop locations in order.
*** DONE Visualizer -- partial rotations of pallet + boxe
*** TODO Test multiple pallets.

** TODO Vivian Requests:
*** TODO Add a "go to taught position" button for validation ?? Where should this button go?
*** DONE There should be a pure jogger screen (not needing to go to pallet config or machine config ?? Extra button on machine configuration for jogger?
*** TODO Layer configuration is tough to use (snapping with overlaps). Need better control of the boxes location too
*** DONE There should be labelled "x and y and z" in every image. With proper orientations ?? Going to need good images then.
*** TODO Path optimization needs to be fixed ?? Can I get a real configuration.
*** DONE There should be a home axes screen in the pallet configuration. Step 3 should not show unless homed first
*** DONE There should be homing buttons in the home page ?? Ah, okay. -- TEST- Jog controller init (release and reset) may not be completed.
*** DONE There should be a system speed and acceleration ?? Will do by drive.boxes properly along rows.
*** DONE Reverse Teach Mode stack direction.

** TODO Database:
*** TODO Editable config.

** TODO New List: 
*** DONE When changing the pick location or changing the box size in the pallet configuration, it's not reflected in the rest of the configuration. This occurs when you edit a pre-existing configuration
*** TODO We should test the same thing to edit teach points for pallets (re-teaching after editing an existing config file)
*** DONE Deleting layer pattern does not work
*** DONE When adding layers and deleting layers, it seems to be upside down (weird UI behaviour) ?? Ask.
*** TODO We need to change the clearance height of the pallet because today during the marketing shoot, we ran into interferences at the fourth layer. I think it'll only get worse for even higher layers. Max, i can show you later today!
*** TODO We need to test for reliability, because it keeps running into errors. I know Max and Alex, you're already on this, but I just wanted us to track this in a list. (https://github.com/VentionCo/mm-vention-control/issues/1129)
*** TODO Max and I talked about how we could improve the user experience to not need to create an offset when configuring the teach points of a pallet. So, we suggested placing 3 boxes at each teach point on the pallet. Teach the EOAT to get to those points and depending on the box size, we could determine the size and position of the pallet. Alex, please let me know if this is clear to you or not.
*** TODO The 3D render still has some glitches in terms of box positioning. I can not reliably repro. But the positions seem off for the boxes.
*** TODO We need to make the drag/drop boxes on the "edit" layer more reliable. Easily snap to the edges of each box, so that the positioning is the same each time, eliminating human error and getting more repeatable positioning. If you have a better option to configure it through "edit rows and columns" format, that would be fine too (after defining the orientation of the box).
*** DONE Replace images/renders from britt to update.
*** DONE Take the "Home x, home y, home z, home theta, done" to step 1. Remove your current step 1 with the jogger to replace it with only the homing buttons. Remove the flow of homing first for pick location, teach points before being able to move onto them. Add drop down menu for "add machine configuration" into the "name pallet configuration" step. This is to match up to Matt's path following app too. 
*** TODO Test the input sensor
*** TODO When moving the boxes when configuring a layer: mouse capture is missing also (i.e. if I mousedown, then move the mouse too quickly, I lose the box, and later when I reenter the area, the box stays attached to mousemove).
*** TODO Automated ordering of boxes based on pick location (to accommodate the lateral movement Max has implemented). Currently, it is manually determined.
*** TODO Automated input sensing.
*** DONE Input Splash Screen.
*** DONE Machine Config Styling
*** TODO Don't remove layers + stack if box pick point is the only thing that changed.

** TODO Final Relevant Items
*** DONE Sorting boxes by row for lateral approach
*** TODO Mechanics of box drag + drop.
*** TODO Monitoring pick quality over path.
*** TODO Updating mechanism for machine apps.
*** DONE Edit Machine Motion. etc.
*** TODO Make sure that the current configuration selection mechanism is robust -- don't allow starting with incomplete configuration.
*** TODO Show stack display realtime in the Stack.tsx.
*** DONE Fix Jogger Bug.
*** TODO Handle master / slave estop situation.
*** TODO Master Slave issue also has to be solved in the control center button.
*** TODO Add positions to machine jogger.
*** TODO Palletizer won't stop when returning to pick location.
*** TODO Pick height is a little high for some reasong.
*** TODO Pick location is still a little frigged for some reason.
*** TODO Changing pick location does not update inside of layers (where the box is copied). This is stupid -- we should get pick location from box index.
*** TODO Add location filter for negative coordinates? 

